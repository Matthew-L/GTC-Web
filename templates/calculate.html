{% extends 'base.html' %}
{% load static %}
{% load get_range %}
{% block content %}
    <a href="#" id="insert-more"> Add New Row </a>

    {# String Set Name Form #}
    <div>
        String Set Name
        <input id="string_set_name_GTC_" class="user_input" type="text">
    </div>
    <div>
        Scale Length
        <input id="scale_length_GTC_" class="user_input" type="text" name="scale_length">
    </div>
    <table border="1" id="strings-tbl">
        <tr>
{#            <th>Set Name</th>#}
            <th>Number</th>
{#            <th>Scale Length</th>#}
            <th>Note</th>
            <th>Octave</th>
            <th>Gauge</th>
            <th>String Type</th>
            <th>Tension</th>
{#            <th>Save</th>#}
{#            <th>Add String</th>#}
        </tr>
        {# New User String Form #}

        {% for i in MAX_STRINGS|get_range %} {% comment %}12 times{% endcomment %}
        <tr class='table_row' id="string_row{{ forloop.counter0 }}" >
            {% include "includes/forms.html" %}
            <td id="tension_GTC_{{ forloop.counter0 }}"></td>
            <td><button type="button" class="remove_btn" id="remove_btn_GTC_{{ forloop.counter0 }}" >Hide</button></td>
        </tr>
        {% endfor %}
    </table>
    <button type="button" class="addstring_btn" >Add String</button>
    <input type='submit' value="Save">
    <label class="error" for="name" id="name_error">This field is required.</label>

{% endblock %}
{% block scripts %}
    {{ block.super }}
    <script src="{% static "assets/js/add_string.js" %}" type="text/javascript"></script>
    <script type="text/javascript"></script>
    <script src="{% static "assets/js/load_string_set_data.js" %}" type="text/javascript"></script>
    <script type="text/javascript">
        var numberOfRows = 22;
        $("#insert-more").click(function () {
            $("#strings-tbl").each(function () {
                var tds = '<tr>';
                jQuery.each($('tr:last td', this), function () {
                    tds += '<td>' + returnValidRow($(this).html(), numberOfRows) + '</td>';
                    //returnValidRow($(this).html(), index)
                    console.log($(this).html())
                });

                tds += '</tr>';
                if ($('tbody', this).length > 0) {
                    $('tbody', this).append(tds);
                } else {
                    $(this).append(tds);
                }

                numberOfRows += 1;

            });
        });

        function returnValidRow(currentRow, rowNumber) {
            //alert(currentRow);
            var id_tag = "_GTC_";
            if (currentRow.indexOf(id_tag) !== -1) {
                tagIndex = currentRow.indexOf(id_tag);
                frontSubstring = currentRow.substr(0, tagIndex)
                backSubstring = currentRow.substr(tagIndex);
                while (backSubstring.charAt(0) != "\"") {
                    backSubstring = currentRow.substr(tagIndex);
                    tagIndex += 1
                }
                backSubstring = currentRow.substr(tagIndex);
                console.log("Original " + currentRow)
                console.log("newrow " + frontSubstring + backSubstring)

                validRow = frontSubstring + id_tag + rowNumber + "\"" + backSubstring
                console.log("valid Row: " + validRow)
                return validRow

            }
        }



    </script>

    <script type="text/javascript">
    </script>
{% endblock %}